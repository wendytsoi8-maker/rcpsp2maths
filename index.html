<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>立體圖形 3D 平台</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif; margin: 0; background:#f6f7fb;}
    .wrap { max-width: 1100px; margin: 20px auto; padding: 16px; }
    .card { background:#fff; border-radius: 14px; padding: 16px; box-shadow: 0 8px 22px rgba(0,0,0,.06); }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
    .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    label { font-size: 13px; color:#333; display:block; margin-bottom: 6px; }
    select, button, input { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #d8dbe6; font-size: 15px; background:#fff; box-sizing: border-box; }
    button { background:#1f6feb; color:#fff; border:none; cursor:pointer; font-weight: 600; }
    button:hover { background:#1a5fd0; }
    .hint { font-size: 13px; color:#555; margin-top: 10px; line-height: 1.5; }
    .resultTitle { font-size: 16px; font-weight: 700; margin: 0 0 6px; }
    .resultMeta { font-size: 13px; color:#444; margin: 0 0 10px; line-height: 1.5; }
    #canvasWrap { height: 520px; border-radius: 14px; overflow:hidden; border: 1px solid #e7e9f2; background: #0b1020; }
    .pill { display:inline-block; font-size:12px; padding: 3px 8px; border-radius:999px; background:#eef2ff; color:#1f2a6b; margin-right:6px; }
    .error { color:#b42318; font-size: 14px; margin-top: 8px; }
    .row { display:flex; gap:10px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>立體圖形 3D 平台（角錐／角柱／圓柱／圓錐／球）</h1>

      <div class="grid">
        <div>
          <div class="controls">
            <div>
              <label>立體種類</label>
              <select id="kind">
                <option value="pyramid">角錐</option>
                <option value="prism">角柱</option>
                <option value="cylinder">圓柱</option>
                <option value="cone">圓錐</option>
                <option value="sphere">球</option>
              </select>
            </div>

            <div>
              <label>角數（只適用：角錐／角柱）</label>
              <select id="n">
                <!-- 你要求 1-20；我保留 1-20，但會對 1/2 角作提示 -->
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
              </select>
            </div>
          </div>

          <div class="row">
            <button id="go">確認並生成</button>
          </div>

          <div class="hint">
            <span class="pill">操作</span>拖曳旋轉；滾輪/兩指縮放。<br/>
            <span class="pill">提示</span>「角錐／角柱」最少要 3 角；1 角/2 角唔係有效多邊形。
          </div>

          <div id="msg" class="error" style="display:none;"></div>
        </div>

        <div>
          <p class="resultTitle" id="resultName">尚未生成</p>
          <p class="resultMeta" id="resultMeta">請先選擇立體種類，然後按「確認並生成」。</p>
          <div id="canvasWrap"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <!-- OrbitControls -->
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    const wrap = document.getElementById("canvasWrap");
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b1020);

    const camera = new THREE.PerspectiveCamera(45, wrap.clientWidth / wrap.clientHeight, 0.1, 100);
    camera.position.set(3.2, 2.4, 3.6);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(wrap.clientWidth, wrap.clientHeight);
    wrap.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    scene.add(new THREE.DirectionalLight(0xffffff, 1.1));
    scene.add(new THREE.AmbientLight(0xffffff, 0.35));

    const gridHelper = new THREE.GridHelper(10, 10, 0x2a335b, 0x1a2244);
    gridHelper.position.y = -1.4;
    scene.add(gridHelper);

    const material = new THREE.MeshStandardMaterial({
      color: 0x6ea8fe,
      roughness: 0.35,
      metalness: 0.05
    });

    let currentMesh = null;

    function showMsg(text){
      const el = document.getElementById("msg");
      el.style.display = "block";
      el.textContent = text;
    }
    function hideMsg(){
      const el = document.getElementById("msg");
      el.style.display = "none";
      el.textContent = "";
    }

    function regularPolygonShape(n, radius=1.0){
      const shape = new THREE.Shape();
      for(let i=0;i<n;i++){
        const a = (i / n) * Math.PI * 2;
        const x = Math.cos(a) * radius;
        const y = Math.sin(a) * radius;
        if(i === 0) shape.moveTo(x, y);
        else shape.lineTo(x, y);
      }
      shape.closePath();
      return shape;
    }

    function makePrism(n){
      const shape = regularPolygonShape(n, 1.0);
      const geo = new THREE.ExtrudeGeometry(shape, { depth: 1.4, bevelEnabled: false });
      geo.center();
      return geo;
    }

    function makePyramid(n){
      // 用 n 邊「圓錐」近似 n 角錐：n=3/4/... 會出到三角錐/四角錐/...
      // radialSegments = n → 底面變成 n 邊形
      const geo = new THREE.ConeGeometry(1.05, 1.8, n, 1, false);
      geo.center();
      return geo;
    }

    function setSolid({name, metaHtml, geometry}){
      if(currentMesh){
        scene.remove(currentMesh);
        currentMesh.geometry.dispose();
      }
      currentMesh = new THREE.Mesh(geometry, material);
      scene.add(currentMesh);

      document.getElementById("resultName").textContent = name;
      document.getElementById("resultMeta").innerHTML = metaHtml;
    }

    function metaFor(kind, n){
      // 「面」只計平面；曲面另外講
      if(kind === "pyramid"){
        return `平面數：<b>${n + 1}</b>（側面 ${n} + 底 1）；曲面：<b>沒有</b>；底數：<b>1</b>`;
      }
      if(kind === "prism"){
        return `平面數：<b>${n + 2}</b>（側面 ${n} + 底 2）；曲面：<b>沒有</b>；底數：<b>2</b>`;
      }
      if(kind === "cylinder"){
        return `平面數：<b>2</b>（上下底）; 曲面：<b>有</b>；底數：<b>2</b>`;
      }
      if(kind === "cone"){
        return `平面數：<b>1</b>（底）; 曲面：<b>有</b>；底數：<b>1</b>`;
      }
      if(kind === "sphere"){
        return `平面數：<b>0</b>；曲面：<b>有</b>；底數：<b>0</b>`;
      }
      return "";
    }

    function generate(){
      hideMsg();
      const kind = document.getElementById("kind").value;
      const n = Number(document.getElementById("n").value);

      // 角錐/角柱：n 必須 >= 3
      if((kind === "pyramid" || kind === "prism") && n < 3){
        showMsg("角錐／角柱最少要 3 角（1 角/2 角唔係有效多邊形）。請改做 3–20。");
        return;
      }

      if(kind === "pyramid"){
        const geo = makePyramid(n);
        setSolid({
          name: `${n} 角錐`,
          metaHtml: metaFor(kind, n),
          geometry: geo
        });
        return;
      }

      if(kind === "prism"){
        const geo = makePrism(n);
        setSolid({
          name: `${n} 角柱`,
          metaHtml: metaFor(kind, n),
          geometry: geo
        });
        return;
      }

      if(kind === "cylinder"){
        const geo = new THREE.CylinderGeometry(0.95, 0.95, 1.8, 48);
        geo.center();
        setSolid({
          name: "圓柱",
          metaHtml: metaFor(kind, n),
          geometry: geo
        });
        return;
      }

      if(kind === "cone"){
        const geo = new THREE.ConeGeometry(0.95, 1.8, 48);
        geo.center();
        setSolid({
          name: "圓錐",
          metaHtml: metaFor(kind, n),
          geometry: geo
        });
        return;
      }

      if(kind === "sphere"){
        const geo = new THREE.SphereGeometry(1.05, 48, 32);
        geo.center();
        setSolid({
          name: "球",
          metaHtml: metaFor(kind, n),
          geometry: geo
        });
        return;
      }
    }

    // UI: 選圓柱/圓錐/球就 disable 角數
    function updateNEnabled(){
      const kind = document.getElementById("kind").value;
      const nSel = document.getElementById("n");
      nSel.disabled = !(kind === "pyramid" || kind === "prism");
    }

    document.getElementById("go").addEventListener("click", generate);
    document.getElementById("kind").addEventListener("change", () => {
      updateNEnabled();
    });

    updateNEnabled();

    function onResize(){
      const w = wrap.clientWidth;
      const h = wrap.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }
    window.addEventListener("resize", onResize);

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      if(currentMesh){
        currentMesh.rotation.y += 0.003; // 輕微自轉
      }
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
